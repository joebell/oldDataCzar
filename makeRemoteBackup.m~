%% makeRemoteBackup.m
%
%  Backs up any in-range file that hasn't been previously backed up to a remote
%  directory via rsync.  
%
%  It works only on the whole dataDir.
%
% JSB 11/2013 
function makeRemoteBackup(varargin)

    % Load settings
    dcSettings = dataCzarSettings();

	list = returnFileList();

    % Copy it to the server
    if (dcSettings.remoteRsyncBackup)
        try
			cmd = ['rsync ',dcSettings.remoteRsyncOptions,' ',dcSettings.dataDir,' ',dcSettings.remoteRsyncHost];
			[status,result] = unix(cmd,'-echo');
            for fileNum=list
                dmIndex.files(fileNum).needsRemoteBackup = false;
                dmIndex.files(fileNum).remoteBackup = dcSettings.remoteRsyncHost;
            end
            % Save the updated index reflecting the local backup  
            loadDmIndex(dmIndex);
			disp('Backup to remote server completed.');
        catch exception
            disp('Backup to server failed.  Are you sure you''re connected?');
        end
    else
        disp('No server configured, no remote backup stored.');
    end	



